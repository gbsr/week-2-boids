(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=a(i);fetch(i.href,n)}})();const ta={triangle:{type:"path",anchor:"tip",forward:"+x",scale:1,points:[[0,0],[-10,4],[-10,-4]]},circle:{type:"circle",anchor:"center",forward:"+x",scale:1,radius:4},diamond:{type:"path",anchor:"center",forward:"+x",scale:1,points:[[8,0],[0,4],[-8,0],[0,-4]]},cross:{type:"path",anchor:"center",forward:"+x",scale:1,points:[[-10,-2],[-2,-2],[-2,-6],[2,-6],[2,-2],[6,-2],[6,2],[2,2],[2,6],[-2,6],[-2,2],[-10,2]]},cake:{type:"path",anchor:"tip",forward:"+x",scale:1,points:[[5,0],[-10,8],[-12,3],[-12,-3],[-10,-8]]},kite:{type:"path",anchor:"center",forward:"+x",scale:1,points:[[3,0],[0,3],[-7,0],[0,-3]]},chevron:{type:"path",anchor:"tip",forward:"+x",scale:1,points:[[0,0],[-8,6],[-6,6],[-2,2],[-2,-2],[-6,-6],[-8,-6]]},leaf:{type:"path",anchor:"center",forward:"+x",scale:1,points:[[9,0],[6,3.5],[0,5],[-8,2],[-9,0],[-8,-2],[0,-5],[6,-3.5]]},capsule:{type:"path",anchor:"center",forward:"+x",scale:1,points:[[8,-3],[8,3],[6,5],[-6,5],[-8,3],[-8,-3],[-6,-5],[6,-5]]},wedge:{type:"path",anchor:"tip",forward:"+x",scale:1,points:[[0,0],[-10,7],[-14,0],[-10,-7]]},particle:{type:"circle",anchor:"center",forward:"+x",scale:1,radius:1},dot:{type:"circle",anchor:"center",forward:"+x",scale:1,radius:.2}},oe={boidCount:{default:980,group:"Simulation",label:"Number of Boids",control:"slider",slider:{min:0,max:1200,step:1},affects:"boid-structure"},perceptionRadius:{default:20,group:"Simulation",label:"Perception",control:"none",slider:{min:5,max:200,step:1}},attractMouse:{default:!1,group:"Interaction",label:"Attract Mouse",control:"checkbox"},repelMouse:{default:!1,group:"Interaction",label:"Repel Mouse",control:"checkbox"},showMouseRadius:{default:!1,group:"Interaction",label:"Show Mouse Radius",control:"checkbox"},spacer_mouseCheckBoxes:{default:0,group:"Interaction",control:"spacer"},mouseRadius:{default:250,group:"Interaction",label:"Mouse Radius",control:"slider",slider:{min:1,max:500,step:1}},mouseInfluence:{default:.25,group:"Interaction",label:"Mouse Influence",control:"slider",slider:{min:0,max:1,step:.01}},spacer_mouseRadius:{default:0,control:"spacer",group:"Interaction"},mouseAttractionWeight:{default:5,group:"Interaction",label:"Mouse Attraction",control:"none",slider:{min:0,max:500,step:.1}},mouseRepelWeight:{default:25,group:"Interaction",label:"Mouse Repel",control:"none",slider:{min:0,max:500,step:.1}},separationWeight:{default:.75,group:"Flocking",label:"Separation",control:"slider",slider:{min:0,max:3,step:.001}},separationRadius:{default:5,group:"Flocking",label:"Radius",control:"slider",slider:{min:0,max:380,step:.5}},spacer_separation:{default:0,group:"Flocking",control:"spacer"},alignmentWeight:{default:.05,group:"Flocking",label:"Alignment",control:"slider",slider:{min:0,max:3,step:.001}},alignmentRadius:{default:30,group:"Flocking",label:"Radius",control:"slider",slider:{min:0,max:380,step:.5}},spacer_alignment:{default:0,group:"Flocking",control:"spacer"},cohesionWeight:{default:.92,group:"Flocking",label:"Cohesion",control:"slider",slider:{min:0,max:3,step:.001}},cohesionRadius:{default:320,group:"Flocking",label:"Radius",control:"slider",slider:{min:0,max:380,step:.5}},spacer_cohesion:{default:0,group:"Flocking",control:"spacer"},maxForce:{default:10,group:"Flocking",label:"Max force",control:"slider",slider:{min:0,max:50,step:.001}},spacer_MaxForce:{default:0,group:"Flocking",control:"spacer"},flockDriftStrength:{default:3,group:"Flocking",label:"Flock Drift",control:"slider",slider:{min:0,max:10,step:.001}},spacer:{default:0,group:"Flocking",control:"spacer"},speedBoostAtEdges:{default:.3,group:"Flocking",label:"Accelerate when far from flock",control:"slider",slider:{min:0,max:1,step:.001}},turnBoostAtEdges:{default:1,group:"Flocking",label:"Turn boost when far from flock",control:"slider",slider:{min:0,max:2,step:.001}},maxSpeed:{default:20,group:"Movement",label:"Max speed",control:"slider",slider:{min:1,max:500,step:.001}},turnRate:{default:10,group:"Movement",label:"Turn rate",control:"slider",slider:{min:.01,max:150,step:.1}},maxWanderForce:{default:20,group:"Movement",label:"Wander force",control:"slider",slider:{min:0,max:50,step:.001}},spacer_wander:{default:0,group:"Movement",control:"spacer"},spacer_wrapEdges:{default:0,group:"Edge",control:"spacer"},boundaryMargin:{default:200,group:"Edge",label:"Margin",control:"slider",slider:{min:0,max:400,step:10}},boundaryStrength:{default:15,group:"Edge",label:"Repel Edge",control:"slider",slider:{min:0,max:300,step:.1}},size:{default:1,group:"Render",label:"Size",control:"slider",slider:{min:.01,max:10,step:.01}},trailLength:{default:.15,group:"Render",label:"Trail length",control:"slider",slider:{min:0,max:1,step:.01}},trailAlpha:{default:1,group:"Render",label:"Trail alpha",control:"none",slider:{min:0,max:1,step:.01}},trailStep:{default:0,group:"Render",label:"Trail step",control:"slider",slider:{min:0,max:30,step:1}},shadowSize:{default:4,group:"Render",label:"Shadow size",control:"slider",slider:{min:0,max:10,step:.1}},shadowOpacity:{default:1,group:"Render",label:"Shadow opacity",control:"slider",slider:{min:0,max:1,step:.01}},randomBoidColors:{default:!1,group:"Render",label:"Random boid colors",control:"checkbox"},randomTrailColors:{default:!1,group:"Render",label:"Random trail colors",control:"checkbox"},theme:{default:"dot",group:"Render",label:"Theme",control:"dropdown",dropdown:{options:["triangle","circle","diamond","cross","cake","kite","chevron","leaf","particle","dot"]},affects:"render-cache"},visualizePerception:{default:!1,group:"Debug - Perception",label:"Show perception radius",control:"none"},perceptionColor:{default:"#00ff00",group:"Debug - Perception",label:"Perception color",control:"none"},perceptionLineWidth:{default:1,group:"Debug - Perception",label:"Perception line width",control:"none",slider:{min:.1,max:5,step:.1}},perceptionAlpha:{default:.3,group:"Debug - Perception",label:"Perception alpha",control:"none",slider:{min:0,max:.5,step:1e-4}},visualizeCohesionRadius:{default:!1,group:"Debug - Cohesion",label:"Show cohesion radius",control:"checkbox"},visualizeCohesionToNeighbors:{default:!1,group:"Debug - Cohesion",label:"Show cohesion → neighbors",control:"checkbox"},cohesionRadiusColor:{default:"#ff00ff",group:"Debug - Cohesion",label:"Cohesion radius color",control:"none"},cohesionRadiusLineWidth:{default:4,group:"Debug - Cohesion",label:"Cohesion line width",control:"slider",slider:{min:.001,max:3,step:.001}},cohesionRadiusAlpha:{default:.03,group:"Debug - Cohesion",label:"Cohesion alpha",control:"slider",slider:{min:0,max:.05,step:1e-4}},visualizeAlignmentRadius:{default:!1,group:"Debug - Alignment",label:"Show alignment radius",control:"checkbox"},visualizeAlignmentToNeighbors:{default:!1,group:"Debug - Alignment",label:"Show alignment → neighbors",control:"checkbox"},alignmentRadiusColor:{default:"#7fe29c",group:"Debug - Alignment",label:"Alignment radius color",control:"none"},alignmentRadiusLineWidth:{default:1,group:"Debug - Alignment",label:"Alignment line width",control:"slider",slider:{min:.001,max:3,step:.01}},alignmentRadiusAlpha:{default:.03,group:"Debug - Alignment",label:"Alignment alpha",control:"slider",slider:{min:0,max:.05,step:1e-4}},visualizeSeparationRadius:{default:!1,group:"Debug - Separation",label:"Show separation radius",control:"checkbox"},visualizeSeparationToNeighbors:{default:!1,group:"Debug - Separation",label:"Show separation → neighbors",control:"checkbox"},separationRadiusColor:{default:"#ff0000",group:"Debug - Separation",label:"Separation radius color",control:"none"},separationRadiusLineWidth:{default:4,group:"Debug - Separation",label:"Separation line width",control:"slider",slider:{min:.01,max:3,step:.01}},separationRadiusAlpha:{default:.03,group:"Debug - Separation",label:"Separation alpha",control:"slider",slider:{min:0,max:.05,step:1e-4}},debugSampleStride:{default:4,group:"Debug",label:"Debug sample stride",control:"none",slider:{min:1,max:10,step:1}},maxDebugNeighbors:{default:200,group:"Debug",label:"Max debug neighbors",control:"none",slider:{min:1,max:450,step:1}}};function oa(){const e={};return Object.keys(oe).forEach(o=>{e[o]=oe[o].default}),e}const t={fsm:{state:"idle"},needsBoidReinit:!1,needsTrailReset:!1,needsFullCanvasReset:!1,params:oa(),mouse:{x:0,y:0,inside:!1},arrays:{position:{x:[],y:[]},velocity:{x:[],y:[]}},viewport:{width:800,height:600}},Y={x:0,y:0,angle:Math.random()*Math.PI*2};function te(e){const o=Math.hypot(e.x,e.y)||1;return{x:e.x/o,y:e.y/o}}function sa(e,o){const a=Math.hypot(e.x,e.y);if(a>o){const s=o/a;return{x:e.x*s,y:e.y*s}}return e}function ia(e,o){return Math.hypot(e.x-o.x,e.y-o.y)}function na(e,o,a){return{x:e.x+(o.x-e.x)*a,y:e.y+(o.y-e.y)*a}}function P(e,o=1){const a=e.replace("#",""),s=parseInt(a,16);if(a.length===3){const d=parseInt(a[0]+a[0],16),m=parseInt(a[1]+a[1],16),R=parseInt(a[2]+a[2],16);return`rgba(${d}, ${m}, ${R}, ${o})`}const i=s>>16&255,n=s>>8&255,l=s&255;return`rgba(${i}, ${n}, ${l}, ${o})`}function Be(e,o){const a=e.getBoundingClientRect();return{x:o.clientX-a.left,y:o.clientY-a.top}}function ra(e,o,a){!t.params.visualizeAlignmentRadius&&!t.params.visualizeAlignmentToNeighbors||(t.params.visualizeAlignmentRadius&&(a.beginPath(),a.arc(e.x,e.y,t.params.alignmentRadius,0,Math.PI*2),a.strokeStyle=P(t.params.alignmentRadiusColor,t.params.alignmentRadiusAlpha*4),a.fillStyle=P(t.params.alignmentRadiusColor,t.params.alignmentRadiusAlpha*1.2),a.lineWidth=t.params.alignmentRadiusLineWidth,a.fill(),a.stroke()),t.params.visualizeAlignmentToNeighbors&&o.forEach(s=>{a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(s.x,s.y),a.strokeStyle=P(t.params.alignmentRadiusColor,t.params.alignmentRadiusAlpha*4),a.lineWidth=t.params.alignmentRadiusLineWidth,a.stroke()}))}function la(e,o,a){!t.params.visualizeCohesionRadius&&!t.params.visualizeCohesionToNeighbors||(t.params.visualizeCohesionRadius&&(a.beginPath(),a.arc(e.x,e.y,t.params.cohesionRadius,0,Math.PI*2),a.strokeStyle=P(t.params.cohesionRadiusColor,t.params.cohesionRadiusAlpha*3),a.fillStyle=P(t.params.cohesionRadiusColor,t.params.cohesionRadiusAlpha*.65),a.lineWidth=t.params.cohesionRadiusLineWidth,a.fill(),a.stroke()),t.params.visualizeCohesionToNeighbors&&o.forEach(s=>{a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(s.x,s.y),a.strokeStyle=P(t.params.cohesionRadiusColor,t.params.cohesionRadiusAlpha*5),a.lineWidth=t.params.cohesionRadiusLineWidth,a.stroke()}))}function be(e,o,a,s){s.length=0;const i=o.x,n=o.y,l=i[e],d=n[e];for(let m=0;m<i.length;m++){if(m===e)continue;ia({x:l,y:d},{x:i[m],y:n[m]})<=a&&s.push({x:i[m],y:n[m]})}}function da(e,o,a){!t.params.visualizeSeparationRadius&&!t.params.visualizeSeparationToNeighbors||(t.params.visualizeSeparationRadius&&(a.beginPath(),a.arc(e.x,e.y,t.params.separationRadius,0,Math.PI*2),a.strokeStyle=P(t.params.separationRadiusColor,t.params.separationRadiusAlpha*3),a.fillStyle=P(t.params.separationRadiusColor,t.params.separationRadiusAlpha*.2),a.lineWidth=t.params.separationRadiusLineWidth,a.fill(),a.stroke()),t.params.visualizeSeparationToNeighbors&&o.forEach(s=>{a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(s.x,s.y),a.strokeStyle=P(t.params.separationRadiusColor,t.params.separationRadiusAlpha*5),a.lineWidth=t.params.separationRadiusLineWidth,a.stroke()}))}const Ne=new WeakMap;function Pe(e){const o=Ne.get(e);if(o)return o;const a=new Path2D,s=e.points;a.moveTo(s[0][0],s[0][1]);for(let i=1;i<s.length;i++)a.lineTo(s[i][0],s[i][1]);return a.closePath(),Ne.set(e,a),a}function ca(){const e=Math.floor(Math.random()*360),o=60+Math.random()*30,a=45+Math.random()*30;return`hsl(${e}, ${o}%, ${a}%)`}function ye(e,o,a,s,i,n=i.size??1,l,d,m){const R=ta[s],w=Math.atan2(a.y,a.x)||0;e.save(),e.translate(o.x,o.y),e.rotate(w);const b=R.scale*n;e.scale(b,b);const C=(i.lineWidth??0)/b,g=e.globalAlpha;if(e.globalAlpha=1,l&&C>0){const v=C*(l.widthMul??1.6),x=l.alpha??.35,y=e.strokeStyle,M=e.lineWidth,T=e.globalAlpha;if(e.globalAlpha=x,e.strokeStyle=l.color,e.lineWidth=v,R.type==="circle"){const z=R.radius??4;e.beginPath(),e.arc(0,0,z,0,Math.PI*2),e.closePath(),e.stroke()}else{const z=Pe(R);e.stroke(z)}e.strokeStyle=y,e.lineWidth=M,e.globalAlpha=T}if(e.lineWidth=C,e.strokeStyle=m??i.stroke,e.fillStyle=d??i.fill,R.type==="circle"){const v=R.radius??4;e.beginPath(),e.arc(0,0,v,0,Math.PI*2),e.closePath(),e.fill(),C>0&&e.stroke()}else{const v=Pe(R);e.fill(v),C>0&&e.stroke(v)}e.globalAlpha=g,e.restore()}let N=null,ie=null,B=1,ue=0,pe=0;function ua(e,o,a){const s=Math.max(1,window.devicePixelRatio||1),i=Math.max(1,Math.floor(o*s)),n=Math.max(1,Math.floor(a*s));(e.width!==i||e.height!==n)&&(e.width=i,e.height=n),B=s}function pa(e,o){const a=Math.max(1,Math.floor(e*B)),s=Math.max(1,Math.floor(o*B));N||(N=document.createElement("canvas"),ie=N.getContext("2d")),(ue!==a||pe!==s)&&(ue=a,pe=s,N.width=ue,N.height=pe)}const V=[],Q=[],$=[],Z=[],ee=[],ae=[],he=[];function ha(e,o,a){if(V.length!==e){V.length=e,Q.length=e,$.length=e,Z.length=e,ee.length=e,ae.length=e,he.length=e;for(let s=0;s<e;s++){V[s]=o[s],Q[s]=a[s],$[s]=0,Z[s]=o[s],ee[s]=a[s];const i=ca();ae[s]=i,he[s]=i}}}function ma(e,o,a,s){const i=o.clientWidth,n=o.clientHeight;ua(o,i,n),pa(i,n),t.needsFullCanvasReset&&(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,o.width,o.height),ie&&N&&(ie.setTransform(1,0,0,1,0,0),ie.clearRect(0,0,N.width,N.height)),V.length=0,Q.length=0,$.length=0,Z.length=0,ee.length=0,ae.length=0,he.length=0,t.needsFullCanvasReset=!1);const l=t.arrays.position.x,d=t.arrays.position.y,m=t.arrays.velocity.x,R=t.arrays.velocity.y,w=l.length;ha(w,l,d);const b=ie;b.setTransform(1,0,0,1,0,0),b.imageSmoothingEnabled=!1;const C=Math.max(1,t.params.trailStep??6),g=Math.max(i,n)*.45,x=(s.size??1)*t.params.size*B,y={...s,lineWidth:(s.lineWidth??0)*B},M=Math.min(1,Math.max(0,t.params.trailLength??1)),T=Math.pow(1-M,2.2);T>0&&(b.globalCompositeOperation="destination-out",b.fillStyle=`rgba(0,0,0,${T})`,b.fillRect(0,0,ue,pe),b.globalCompositeOperation="source-over");for(let r=0;r<w;r++){const A=V[r],F=Q[r],j=l[r],H=d[r],q=j-A,U=H-F,O=Math.hypot(q,U);if(!isFinite(O)||O>g){V[r]=j,Q[r]=H,Z[r]=j,ee[r]=H,$[r]=0;continue}$[r]+=O;const ve=O>0?q/O:0,se=O>0?U/O:0;for(;$[r]>=C;){Z[r]+=ve*C,ee[r]+=se*C,$[r]-=C;const xe=t.params.randomTrailColors?ae[r]:y.fill,Me=t.params.randomTrailColors?ae[r]:y.stroke;ye(b,{x:Z[r]*B,y:ee[r]*B},{x:q,y:U},s.shape,y,x,{color:"#000",alpha:t.params.shadowOpacity,widthMul:t.params.shadowSize},xe,Me)}V[r]=j,Q[r]=H}e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,o.width,o.height),e.imageSmoothingEnabled=!1,e.globalCompositeOperation="source-over",e.globalAlpha=1,e.drawImage(N,0,0),e.setTransform(B,0,0,B,0,0),e.globalCompositeOperation="source-over",e.globalAlpha=1;const z=(s.size??1)*t.params.size;for(let r=0;r<w;r++){const A=t.params.randomBoidColors?ae[r]:void 0,F=t.params.randomBoidColors?he[r]:void 0;ye(e,{x:l[r],y:d[r]},{x:m[r],y:R[r]},s.shape,s,z,void 0,A,F)}const k=t.params.mouseRadius??0,u=t.params.attractMouse,c=t.params.showMouseRadius??!0,S=t.mouse;S&&S.inside&&k>0&&c&&(e.save(),e.beginPath(),e.arc(S.x,S.y,k,0,Math.PI*2),e.setLineDash([6,4]),e.lineWidth=1,e.strokeStyle=u?"rgba(0, 255, 0, 0.4)":"rgba(255, 0, 0, 0.4)",e.stroke(),e.setLineDash([]),e.restore());const h=[],f=t.params.debugSampleStride&&t.params.debugSampleStride>0?t.params.debugSampleStride:Math.max(1,Math.floor(w/200)),W=t.params.maxDebugNeighbors&&t.params.maxDebugNeighbors>0?t.params.maxDebugNeighbors:16;if(t.params.visualizeAlignmentRadius||t.params.visualizeAlignmentToNeighbors)for(let r=0;r<w;r+=f)h.length=0,be(r,{x:l,y:d},t.params.alignmentRadius,h),h.length>W&&(h.length=W),ra({x:l[r],y:d[r]},h,e);if(t.params.visualizeCohesionRadius||t.params.visualizeCohesionToNeighbors)for(let r=0;r<w;r+=f)h.length=0,be(r,{x:l,y:d},t.params.cohesionRadius,h),h.length>W&&(h.length=W),la({x:l[r],y:d[r]},h,e);if(t.params.visualizeSeparationRadius||t.params.visualizeSeparationToNeighbors)for(let r=0;r<w;r+=f)h.length=0,be(r,{x:l,y:d},t.params.separationRadius,h),h.length>W&&(h.length=W),da({x:l[r],y:d[r]},h,e)}const Oe={backgroundColor:"#000000",border:"1px solid #333333"},Xe=Object.fromEntries(Object.entries(oe).map(([e,o])=>[e,o.default])),fa={boidCount:980,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:1.577,separationRadius:130,spacer_separation:0,alignmentWeight:2.873,alignmentRadius:96,spacer_alignment:0,cohesionWeight:.797,cohesionRadius:217,spacer_cohesion:0,maxForce:27.287,spacer_MaxForce:0,flockDriftStrength:2.773,spacer:0,speedBoostAtEdges:.772,turnBoostAtEdges:1,maxSpeed:26.862,turnRate:13.51,maxWanderForce:.968,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:10,boundaryStrength:36.3,size:.87,trailLength:.15,trailAlpha:1,trailStep:0,shadowSize:4,shadowOpacity:1,randomBoidColors:!1,randomTrailColors:!1,theme:"dot",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:3,cohesionRadiusAlpha:.03,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.001,alignmentRadiusAlpha:.03,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:3,separationRadiusAlpha:.03,debugSampleStride:4,maxDebugNeighbors:200},je={default:{boidCount:40,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:2.517,separationRadius:81,spacer_separation:0,alignmentWeight:1.365,alignmentRadius:96,spacer_alignment:0,cohesionWeight:1.308,cohesionRadius:232,spacer_cohesion:0,maxForce:17.439,spacer_MaxForce:0,flockDriftStrength:6.184,spacer:0,speedBoostAtEdges:.099,turnBoostAtEdges:1.495,maxSpeed:165.597,turnRate:10.31,maxWanderForce:43.484,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:110,boundaryStrength:123,size:.87,trailLength:.7,trailAlpha:1,trailStep:0,shadowSize:4,shadowOpacity:1,randomBoidColors:!1,randomTrailColors:!1,theme:"dot",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:3,cohesionRadiusAlpha:.03,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.001,alignmentRadiusAlpha:.03,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:3,separationRadiusAlpha:.03,debugSampleStride:4,maxDebugNeighbors:200},"Broken Michelin Man":{boidCount:5,perceptionRadius:20,attractMouse:!0,repelMouse:!1,showMouseRadius:!0,spacer_mouseCheckBoxes:0,mouseRadius:419,mouseInfluence:1,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:2.781,separationRadius:135.5,spacer_separation:0,alignmentWeight:1.021,alignmentRadius:375.5,spacer_alignment:0,cohesionWeight:.92,cohesionRadius:320,spacer_cohesion:0,maxForce:34.33,spacer_MaxForce:0,flockDriftStrength:3,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:1.72,maxSpeed:500,turnRate:140.31,maxWanderForce:20,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:200,boundaryStrength:15,size:2.18,trailLength:.89,trailAlpha:1,trailStep:21,shadowSize:7.1,shadowOpacity:1,randomBoidColors:!1,randomTrailColors:!1,theme:"particle",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:3,cohesionRadiusAlpha:.0404,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.001,alignmentRadiusAlpha:.03,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:3,separationRadiusAlpha:.03,debugSampleStride:4,maxDebugNeighbors:200},"wait for meeeee!":{boidCount:152,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:1.462,separationRadius:37.5,spacer_separation:0,alignmentWeight:1.251,alignmentRadius:297,spacer_alignment:0,cohesionWeight:.387,cohesionRadius:245.5,spacer_cohesion:0,maxForce:22.68,spacer_MaxForce:0,flockDriftStrength:9.976,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:1.941,maxSpeed:460.05,turnRate:135.11,maxWanderForce:50,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:80,boundaryStrength:45.4,size:1.11,trailLength:.96,trailAlpha:1,trailStep:0,shadowSize:1.7,shadowOpacity:.47,randomBoidColors:!1,randomTrailColors:!0,theme:"kite",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:3,cohesionRadiusAlpha:.03,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!0,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:.121,alignmentRadiusAlpha:.0289,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:3,separationRadiusAlpha:.03,debugSampleStride:4,maxDebugNeighbors:200},test:fa,"Interstellar Painter":{boidCount:1200,perceptionRadius:20,attractMouse:!1,repelMouse:!0,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:500,mouseInfluence:.98,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:2.917,separationRadius:380,spacer_separation:0,alignmentWeight:0,alignmentRadius:0,spacer_alignment:0,cohesionWeight:2.512,cohesionRadius:375.5,spacer_cohesion:0,maxForce:49.332,spacer_MaxForce:0,flockDriftStrength:2.02,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:2,maxSpeed:103.085,turnRate:98.71,maxWanderForce:50,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:40,boundaryStrength:300,size:.56,trailLength:.91,trailAlpha:1,trailStep:0,shadowSize:.3,shadowOpacity:.08,randomBoidColors:!0,randomTrailColors:!0,theme:"dot",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!0,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:.093,cohesionRadiusAlpha:.0029,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.001,alignmentRadiusAlpha:.03,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:.61,separationRadiusAlpha:.0018,debugSampleStride:4,maxDebugNeighbors:200},"Disney Germs":{boidCount:789,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:3,separationRadius:176.5,spacer_separation:0,alignmentWeight:2.588,alignmentRadius:380,spacer_alignment:0,cohesionWeight:1.328,cohesionRadius:264.5,spacer_cohesion:0,maxForce:50,spacer_MaxForce:0,flockDriftStrength:0,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:2,maxSpeed:60.719,turnRate:149.91,maxWanderForce:37.842,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:0,boundaryStrength:300,size:10,trailLength:.89,trailAlpha:1,trailStep:9,shadowSize:10,shadowOpacity:1,randomBoidColors:!1,randomTrailColors:!1,theme:"dot",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:3,cohesionRadiusAlpha:.03,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.001,alignmentRadiusAlpha:.03,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:3,separationRadiusAlpha:.03,debugSampleStride:4,maxDebugNeighbors:200},"In the core":{boidCount:958,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:1.577,separationRadius:130,spacer_separation:0,alignmentWeight:2.873,alignmentRadius:96,spacer_alignment:0,cohesionWeight:.797,cohesionRadius:217,spacer_cohesion:0,maxForce:27.287,spacer_MaxForce:0,flockDriftStrength:2.773,spacer:0,speedBoostAtEdges:.772,turnBoostAtEdges:1,maxSpeed:500,turnRate:143.91,maxWanderForce:0,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:210,boundaryStrength:300,size:.33,trailLength:.57,trailAlpha:1,trailStep:7,shadowSize:10,shadowOpacity:1,randomBoidColors:!1,randomTrailColors:!1,theme:"circle",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!0,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:.052,cohesionRadiusAlpha:.05,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!0,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.311,alignmentRadiusAlpha:.05,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!0,separationRadiusColor:"#ff0000",separationRadiusLineWidth:.24,separationRadiusAlpha:.0029,debugSampleStride:4,maxDebugNeighbors:200},"Tri-print":{boidCount:267,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:3,separationRadius:53,spacer_separation:0,alignmentWeight:0,alignmentRadius:0,spacer_alignment:0,cohesionWeight:.538,cohesionRadius:380,spacer_cohesion:0,maxForce:50,spacer_MaxForce:0,flockDriftStrength:0,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:2,maxSpeed:500,turnRate:80.41,maxWanderForce:0,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:70,boundaryStrength:238.3,size:1.67,trailLength:.97,trailAlpha:1,trailStep:0,shadowSize:1.2,shadowOpacity:.3,randomBoidColors:!1,randomTrailColors:!1,theme:"triangle",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!1,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:.052,cohesionRadiusAlpha:.05,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:1.311,alignmentRadiusAlpha:.05,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:.24,separationRadiusAlpha:.05,debugSampleStride:4,maxDebugNeighbors:200},"Anime Pasta":{boidCount:551,perceptionRadius:20,attractMouse:!1,repelMouse:!1,showMouseRadius:!1,spacer_mouseCheckBoxes:0,mouseRadius:250,mouseInfluence:.25,spacer_mouseRadius:0,mouseAttractionWeight:5,mouseRepelWeight:25,separationWeight:3,separationRadius:380,spacer_separation:0,alignmentWeight:3,alignmentRadius:380,spacer_alignment:0,cohesionWeight:2.26,cohesionRadius:269.5,spacer_cohesion:0,maxForce:16.081,spacer_MaxForce:0,flockDriftStrength:1.912,spacer:0,speedBoostAtEdges:1,turnBoostAtEdges:2,maxSpeed:499.08,turnRate:2.01,maxWanderForce:37.92,spacer_wander:0,spacer_wrapEdges:0,boundaryMargin:30,boundaryStrength:300,size:1.55,trailLength:.94,trailAlpha:1,trailStep:0,shadowSize:0,shadowOpacity:.1,randomBoidColors:!1,randomTrailColors:!1,theme:"particle",visualizePerception:!1,perceptionColor:"#00ff00",perceptionLineWidth:1,perceptionAlpha:.3,visualizeCohesionRadius:!0,visualizeCohesionToNeighbors:!1,cohesionRadiusColor:"#ff00ff",cohesionRadiusLineWidth:.194,cohesionRadiusAlpha:.0034,visualizeAlignmentRadius:!1,visualizeAlignmentToNeighbors:!1,alignmentRadiusColor:"#7fe29c",alignmentRadiusLineWidth:.071,alignmentRadiusAlpha:.0088,visualizeSeparationRadius:!1,visualizeSeparationToNeighbors:!1,separationRadiusColor:"#ff0000",separationRadiusLineWidth:.11,separationRadiusAlpha:.0083,debugSampleStride:4,maxDebugNeighbors:200}};function ga(){try{const e="boidPresets";let o;const a=localStorage.getItem(e);if(a?o=JSON.parse(a):(o=je,localStorage.setItem(e,JSON.stringify(je))),!o||!o.default)return;const s=o.default;for(const i of Object.keys(s))t.params[i]=s[i];t.needsTrailReset=!0,t.needsBoidReinit=!0}catch(e){console.error("Failed to load default preset:",e)}}function Ra(e,o){Object.assign(e.style,{backgroundColor:Oe.backgroundColor,border:Oe.border});const a=t.params;for(const n of Object.keys(Xe))n in a&&(a[n]=Xe[n]);a.perception??=a.perceptionRadius,a.wSeparation??=a.separationWeight,a.wAlignment??=a.alignmentWeight,a.wCohesion??=a.cohesionWeight,a.needsReseed=!0,t.needsBoidReinit=!0,t.needsTrailReset=!0;function s(){const n=window.devicePixelRatio||1,l=e.getBoundingClientRect(),d=Math.max(1,Math.floor(l.width*n)),m=Math.max(1,Math.floor(l.height*n)),R=t.viewport.width,w=t.viewport.height;e.width=d,e.height=m,o.setTransform(n,0,0,n,0,0);const b=d/R,C=m/w,g=t.arrays.position.x,v=t.arrays.position.y;for(let x=0;x<g.length;x++)g[x]*=b,v[x]*=C;t.viewport.width=d,t.viewport.height=m,t.needsTrailReset=!0}window.addEventListener("resize",()=>{s()});function i(n){n.addEventListener("pointermove",l=>{const{x:d,y:m}=Be(n,l);t.mouse.x=d,t.mouse.y=m,t.mouse.inside=!0}),n.addEventListener("pointerenter",l=>{const{x:d,y:m}=Be(n,l);t.mouse.x=d,t.mouse.y=m,t.mouse.inside=!0}),n.addEventListener("pointerleave",()=>{t.mouse.inside=!1})}s(),i(e),ga()}function ba(e){if(e<=0)return{x:0,y:0};const o=Math.random()*Math.PI*2,a=Math.random()*e;return{x:Math.cos(o)*a,y:Math.sin(o)*a}}function ya(e,o,a,s){const{x:i,y:n}=o.position,{x:l,y:d}=o.velocity,m=i[e],R=n[e],w=a*a;let b=0,C=0,g=0;for(let x=0;x<i.length;x++){if(x===e)continue;const y=i[x]-m,M=n[x]-R;y*y+M*M<=w&&(b+=l[x],C+=d[x],g++)}if(!g)return{x:l[e],y:d[e]};const v=te({x:b/g,y:C/g});return{x:v.x*s,y:v.y*s}}function Se(e,o,a,s,i){const n=o.x-a.x[e],l=o.y-a.y[e],d=sa({x:n,y:l},s);return{x:d.x*i,y:d.y*i}}function Sa(e,o){const a=ya(e,o,t.params.alignmentRadius,t.params.maxSpeed);return Se(e,a,o.velocity,t.params.maxForce,t.params.wAlignment)}function Ca(e,o,a,s){const{x:i,y:n}=o.position,l=i[e],d=n[e],m=a*a;let R=0,w=0,b=0;for(let g=0;g<i.length;g++){if(g===e)continue;const v=i[g]-l,x=n[g]-d;v*v+x*x<=m&&(R+=i[g],w+=n[g],b++)}if(!b)return{x:0,y:0};const C=te({x:R/b-l,y:w/b-d});return{x:C.x*s,y:C.y*s}}function va(e,o){const a=Ca(e,o,t.params.cohesionRadius,t.params.maxSpeed);return Se(e,a,o.velocity,t.params.maxForce,t.params.wCohesion)}function xa(e,o,a,s){const i=o.position.x,n=o.position.y,l=i[e],d=n[e],m=a*a;let R=0,w=0,b=0;for(let g=0;g<i.length;g++){if(g===e)continue;const v=l-i[g],x=d-n[g],y=v*v+x*x;if(y<=m){const M=Math.sqrt(y)||1;R+=v/M,w+=x/M,b++}}if(!b)return{x:0,y:0};const C=te({x:R,y:w});return{x:C.x*s,y:C.y*s}}function Ma(e,o){const a=xa(e,o,t.params.separationRadius,t.params.maxSpeed);return Se(e,a,o.velocity,t.params.maxForce,t.params.wSeparation)}function wa(e,o=t.fsm.state,a){if(o!=="running")return;const{wrapEdges:s,maxSpeed:i,turnRate:n,cohesionRadius:l,speedBoostAtEdges:d,turnBoostAtEdges:m,separationWeight:R,alignmentWeight:w,cohesionWeight:b,separationRadius:C,alignmentRadius:g,maxWanderForce:v,boidCount:x}=t.params,y=t.arrays.position.x,M=t.arrays.position.y,T=t.arrays.velocity.x,z=t.arrays.velocity.y;let k=y.length;const u=x??k;if(u>k){const p=a.clientWidth||a.width,le=a.clientHeight||a.height;for(let I=k;I<u;I++)y[I]=Math.random()*p,M[I]=Math.random()*le,T[I]=0,z[I]=0}else u<k&&(y.length=u,M.length=u,T.length=u,z.length=u);if(k=y.length,k===0)return;const c=1-Math.exp(-n*e);Y.angle+=(Math.random()-.5)*.2,Y.x=Math.cos(Y.angle),Y.y=Math.sin(Y.angle);const S=t.params.flockDriftStrength??.1,h=l??Math.min(a.clientWidth,a.clientHeight)*.5,f=d??0,W=m??0,r=380,A=p=>Math.min(1,Math.max(0,p)),F=A((t.params.mouseInfluence??0)*.1),j=A((C??0)/r),H=A((g??0)/r),q=A((l??0)/r),U=Math.min(a.clientWidth,a.clientHeight),se=A(i/150*.2)*U*.5,qe=A((v??0)/150)*se;let me=0,fe=0;for(let p=0;p<k;p++)me+=y[p],fe+=M[p];me/=k,fe/=k;const _=t.params.boundaryMargin??200,we=t.params.boundaryStrength??15,re=t.mouse,We=t.params.attractMouse,Ae=t.params.repelMouse,ze=t.params.mouseRadius??0,Ue=t.params.mouseAttractionWeight??0,Je=t.params.mouseRepelWeight??0,Ge=t.params.speedBoostFromMouse??0,Ke=t.params.turnBoostFromMouse??0;for(let p=0;p<k;p++){const le=Sa(p,t.arrays),I=va(p,t.arrays),ke=Ma(p,t.arrays),Ee=ba(qe),J={x:ke.x*R*j+le.x*w*H+I.x*b*q+Ee.x+Y.x*S,y:ke.y*R*j+le.y*w*H+I.y*b*q+Ee.y+Y.y*S};let Le=1,Te=1;if(re&&re.inside&&(We||Ae)){const E=re.x-y[p],L=re.y-M[p],X=Math.hypot(E,L)||1e-4,D=(We?Ue:0)-(Ae?Je:0);if(D!==0){const G=E/X,K=L/X,aa=ze>0?ze:U,ge=A(1-X/aa),Re=Math.abs(D)*F,Ie=Re*ge*se,De=D>0?1:-1;J.x+=G*Ie*De,J.y+=K*Ie*De,Le=1+Ge*Re*ge,Te=1+Ke*Re*ge}}if(!s){let E=0,L=0;const X=a.clientWidth,D=a.clientHeight,G=y[p],K=M[p];G<_?E+=(_-G)/_:G>X-_&&(E-=(G-(X-_))/_),K<_?L+=(_-K)/_:K>D-_&&(L-=(K-(D-_))/_),J.x+=E*we,J.y+=L*we}let de=1,ce=1;if(h>0&&(f!==0||W!==0)){const E=me-y[p],L=fe-M[p],X=Math.hypot(E,L),D=Math.min(1,X/h);de=1+D*f,ce=1+D*W,F>0&&(de+=F*f,ce+=F*W)}de*=Le,ce*=Te;const Qe=te({x:T[p],y:z[p]});let Ze=te({x:T[p]+J.x,y:z[p]+J.y});const ea=Math.min(1,c*ce),_e=te(na(Qe,Ze,ea)),Fe=se*de;if(T[p]=_e.x*Fe,z[p]=_e.y*Fe,y[p]+=T[p]*e,M[p]+=z[p]*e,s){const E=a.clientWidth,L=a.clientHeight;y[p]>E&&(y[p]=0),y[p]<0&&(y[p]=E),M[p]>L&&(M[p]=0),M[p]<0&&(M[p]=L)}else{const E=a.clientWidth,L=a.clientHeight;y[p]<0&&(y[p]=0),y[p]>E&&(y[p]=E),M[p]<0&&(M[p]=0),M[p]>L&&(M[p]=L)}}}function Wa(e){if(!t.params.needsReseed)return;const o=t.params.boidCount,a=t.arrays.position.x,s=t.arrays.position.y,i=t.arrays.velocity.x,n=t.arrays.velocity.y,l=a.length;if(o<l)a.length=o,s.length=o,i.length=o,n.length=o;else if(o>l){const d=e.clientWidth,m=e.clientHeight;for(let R=l;R<o;R++){a.push(Math.random()*d),s.push(Math.random()*m);const w=Math.random()*Math.PI*2;i.push(Math.cos(w)),n.push(Math.sin(w))}}t.params.needsReseed=!1}const Aa={triangle:{fill:"#f5f5f7",stroke:"#5ec8ff",lineWidth:6,shape:"triangle",size:2.5},circle:{fill:"#f5f5f7",stroke:"#ff6e6e",lineWidth:1,shape:"circle",size:1.65},diamond:{fill:"#3a3a3a",stroke:"#fff",lineWidth:1,shape:"diamond",size:2.25},cross:{fill:"#ffdd57",stroke:"#ffaa00",lineWidth:2,shape:"cross",size:1.5},cake:{fill:"#ff31e4",stroke:"#333",lineWidth:3,shape:"cake",size:2},kite:{fill:"#e1ffd4",stroke:"#4caf50",lineWidth:2,shape:"kite",size:2},chevron:{fill:"#fff0f5",stroke:"#ff69b4",lineWidth:2,shape:"chevron",size:2},leaf:{fill:"#d0f0c0",stroke:"#228b22",lineWidth:2,shape:"leaf",size:2},capsule:{fill:"#000000",stroke:"#ffbfba",lineWidth:2,shape:"capsule",size:2},wedge:{fill:"#fff5e1",stroke:"#ff8c00",lineWidth:2,shape:"wedge",size:2},particle:{fill:"#ffffff",stroke:"#ccc",lineWidth:1,shape:"circle",size:1},dot:{fill:"#ffffff",stroke:"#ffffff",lineWidth:.35,shape:"circle",size:.25}};function Ce(e){const o=oe[e];if(!(!o||!o.affects))switch(o.affects){case"boid-structure":t.needsBoidReinit=!0;break;case"render-cache":t.needsTrailReset=!0;break}}function za(e){const o=document.createElement("div"),a=document.createElement("label");a.textContent=e.label,a.htmlFor=e.paramId,o.appendChild(a);const s=document.createElement("input");s.type="range",s.id=e.paramId,s.min=String(e.min),s.max=String(e.max),e.step!=null&&(s.step=String(e.step));const i=t.params[e.paramId],n=(typeof i=="number"?i:void 0)??e.defaultValue??e.min;return s.value=String(n),s.addEventListener("input",()=>{t.params[e.paramId]=Number(s.value),Ce(e.paramId)}),o.appendChild(s),o}function ka(e){const o=document.createElement("div"),a=document.createElement("label");a.textContent=e.label,a.htmlFor=e.paramId,o.appendChild(a);const s=document.createElement("select");s.id=e.paramId;for(const l of e.options){const d=document.createElement("option");d.value=String(l.value),d.textContent=l.label,s.appendChild(d)}const i=t.params[e.paramId],n=i??void 0??e.defaultValue??e.options[0].value;return s.value=String(n),s.addEventListener("change",()=>{t.params[e.paramId]=s.value,Ce(e.paramId)}),o.appendChild(s),o}function Ea(e){const o=document.createElement("div"),a=document.createElement("label");a.textContent=e.label,a.htmlFor=e.paramId,o.appendChild(a);const s=document.createElement("input");s.type="checkbox",s.id=e.paramId;const i=t.params[e.paramId],n=(typeof i=="boolean"?i:void 0)??e.defaultValue??!1;return s.checked=n,s.addEventListener("input",()=>{t.params[e.paramId]=s.checked,Ce(e.paramId)}),o.appendChild(s),o}function La(){const e=document.createElement("div"),o=document.createElement("div");return o.classList.add("spacer"),e.appendChild(o),e}function Ta(){try{const e=localStorage.getItem("boidPresets");if(!e)return{};const o=JSON.parse(e);return o&&typeof o=="object"?o:{}}catch{return{}}}function He(e){try{localStorage.setItem("boidPresets",JSON.stringify(e))}catch{}}function _a(e){e.innerHTML="";const o=new Map,a=document.createElement("div");a.classList.add("preset-bar");const s=document.createElement("div");s.classList.add("preset-title"),s.textContent="Presets";const i=document.createElement("div");i.classList.add("preset-row");const n=document.createElement("select");n.classList.add("preset-select");const l=document.createElement("button");l.type="button",l.classList.add("preset-btn"),l.textContent="Load",i.appendChild(n),i.appendChild(l);const d=document.createElement("div");d.classList.add("preset-row");const m=document.createElement("input");m.type="text",m.classList.add("preset-name"),m.placeholder="Preset name";const R=document.createElement("button");R.type="button",R.classList.add("preset-btn"),R.textContent="Save",document.createElement("div").classList.add("preset-row");const b=document.createElement("button");b.type="button",b.classList.add("preset-btn"),b.textContent="Export";const C=document.createElement("button");C.type="button",C.classList.add("preset-btn"),C.textContent="Import";const g=document.createElement("input");g.type="file",g.accept="application/json",g.style.display="none",d.appendChild(m),d.appendChild(R),d.appendChild(b),d.appendChild(C),a.appendChild(s),a.appendChild(i),a.appendChild(d),a.appendChild(g),e.appendChild(a);let v=Ta();function x(){const u={};for(const c of Object.keys(oe))u[c]=t.params[c];return u}function y(){const u=n.value;n.innerHTML="";const c=Object.keys(v);c.includes("default")||c.unshift("default");for(const S of c){const h=document.createElement("option");h.value=S,h.textContent=S,n.appendChild(h)}u&&c.includes(u)?n.value=u:n.value="default"}function M(u){let c=v[u];if(!c&&u==="default"&&(c=x()),!!c){for(const[S,h]of Object.entries(c)){t.params[S]=h;const f=o.get(S);f&&(f instanceof HTMLSelectElement?(f.value=String(h),f.dispatchEvent(new Event("change",{bubbles:!0}))):f instanceof HTMLInputElement&&(f.type==="checkbox"?(f.checked=!!h,f.dispatchEvent(new Event("change",{bubbles:!0}))):(f.value=String(h),f.dispatchEvent(new Event("input",{bubbles:!0})))))}t.needsFullCanvasReset=!0,t.needsTrailReset=!0}}function T(u){const c=u.trim();if(!c)return;const S=x();v[c]=S,He(v),y(),n.value=c}y(),l.addEventListener("click",()=>{const u=n.value||"default";M(u)}),R.addEventListener("click",()=>{const u=m.value.trim()||n.value.trim()||"default";T(u)}),b.addEventListener("click",()=>{const u=m.value.trim()||n.value.trim()||"preset",c=x(),S=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),h=URL.createObjectURL(S),f=document.createElement("a");f.href=h,f.download=`${u}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(h)}),C.addEventListener("click",()=>{g.click()}),g.addEventListener("change",()=>{const u=g.files?.[0];if(!u)return;const c=new FileReader;c.onload=()=>{try{const S=JSON.parse(String(c.result));if(!S||typeof S!="object")return;const f=u.name.replace(/\.json$/i,"")||"imported";v[f]=S,He(v),y(),n.value=f,M(f)}catch{}},c.readAsText(u),g.value=""});const z=new Map;function k(u){let c=z.get(u);if(!c){const S=document.createElement("section");S.classList.add("param-group");const h=document.createElement("button");h.type="button",h.classList.add("param-group-header");const f=document.createElement("span");f.classList.add("param-group-chevron"),f.textContent="▾";const W=document.createElement("span");W.classList.add("param-group-title"),W.textContent=u,h.appendChild(f),h.appendChild(W),S.appendChild(h);const r=document.createElement("div");r.classList.add("param-group-content"),S.appendChild(r),S.classList.add("collapsed"),h.addEventListener("click",()=>{const A=S.classList.toggle("collapsed");f.textContent=A?"▸":"▾"}),c={section:S,content:r},z.set(u,c)}return c.content}for(const[u,c]of Object.entries(oe)){if(c.control==="none")continue;const S=c.group??"Misc",h=k(S),f="label"in c?c.label??u:u;if(c.control==="slider"){const W={paramId:u,label:f,min:c.slider.min,max:c.slider.max,step:c.slider.step,defaultValue:c.default},r=za(W);h.appendChild(r);const A=r.querySelector("input[type='range']");A&&o.set(u,A)}else if(c.control==="checkbox"){const W={paramId:u,label:f,defaultValue:c.default},r=Ea(W);h.appendChild(r);const A=r.querySelector("input[type='checkbox']");A&&o.set(u,A)}else if(c.control==="dropdown"){const W={paramId:u,label:f,options:c.dropdown.options.map(F=>({value:F,label:F})),defaultValue:c.default},r=ka(W);h.appendChild(r);const A=r.querySelector("select");A&&o.set(u,A)}else if(c.control==="spacer"){const W=La();h.appendChild(W)}}for(const{section:u,content:c}of z.values())c.children.length>0&&e.appendChild(u);v.default&&(n.value="default",M("default"))}document.querySelector("#app").innerHTML=`
  <div class="main-content">
    <div class="aside">
      <h1>Boids Simulation</h1>
      <div class="controls" id="ui-panel"></div>
    </div>
    <div class="canvasWrapper">
      <canvas id="boidsCanvas"></canvas>
    </div>
  </div>
`;const ne=document.getElementById("boidsCanvas"),$e=ne.getContext("2d");t.fsm.state="running";Ra(ne,$e);window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("ui-panel");if(!e){console.error("UI panel not found");return}_a(e)});let Ye=performance.now();function Ve(e){const o=Math.max(0,Math.min(.05,(e-Ye)/1e3));Ye=e,Wa(ne),wa(o,t.fsm.state,ne);const a=Aa[t.params.theme];ma($e,ne,ye,a),requestAnimationFrame(Ve)}requestAnimationFrame(Ve);
